;(function($){var configureForm=function(lang){var $frequencyField=$('<select>'),$priorityField=$('<select>');$.each($.osmap.fields.frequencies,function(value,text){$('<option>').attr('value',value).text(text).appendTo($frequencyField)});$.each($.osmap.fields.priorities,function(index,value){$('<option>').attr('value',value).text(value).appendTo($priorityField);});function createPriorityField($tr){$div=$tr.find('.sitemapitem-priority');$input=$priorityField.clone();$input.val($div.data('value'));$div.html('');$div.append($input);$input.on('change',function(){$this=$(this);$this.parent().data('value',$this.val());$this.parents('tr').addClass('updated');});}
function removePriorityField($tr){$div=$tr.find('.sitemapitem-priority');$div.text($div.data('value'));}
function createChangeFreqField($tr){$div=$tr.find('.sitemapitem-changefreq');$input=$frequencyField.clone();$input.val($div.data('value'));$div.html('');$div.append($input);$input.change(function(event){$this=$(this);$this.parent().data('value',$this.val());$this.parents('tr').addClass('updated');});}
function removeChangeFreqField($tr){$div=$tr.find('.sitemapitem-changefreq');$div.text($div.find('option:selected').text());}
$('#itemList .sitemapitem').hover(function(event){if(event.target.tagName==='TD'){$tr=$(event.currentTarget);$currentSelection=$('#itemList .selected');if($tr!=$currentSelection){$currentSelection.removeClass('selected');removePriorityField($currentSelection);removeChangeFreqField($currentSelection);$tr.addClass('selected');createPriorityField($tr);createChangeFreqField($tr);}}});$('#itemList .sitemapitem-published').click(function(event){var $this=$(this),newValue=$this.data('value')==1?0:1,spanClass=newValue==1?'publish':'unpublish',$span=$this.find('span');$this.data('value',newValue);$this.parents('.sitemapitem').addClass('updated');$span.attr('class','');$span.addClass('icon-'+spanClass);$span.attr('title',newValue==1?lang.COM_OSMAP_TOOLTIP_CLICK_TO_UNPUBLISH:lang.COM_OSMAP_TOOLTIP_CLICK_TO_PUBLISH);$span.tooltip('destroy');$span.tooltip();});Joomla.submitbutton=function(task){if(task==='sitemapitems.save'||task==='sitemapitems.apply'){var $updateDataField=$('#update-data'),$updatedLines=$('.sitemapitem.updated'),data=[];$updateDataField.val('');$updatedLines.each(function(){$tr=$(this);data.push({'uid':$tr.data('uid'),'settings_hash':$tr.data('settings-hash'),'published':$tr.find('.sitemapitem-published').data('value'),'priority':$tr.find('.sitemapitem-priority').data('value'),'changefreq':$tr.find('.sitemapitem-changefreq').data('value')});});$updateDataField.val(JSON.stringify(data));}
Joomla.submitform(task,document.getElementById('adminForm'));};setTimeout(function(){$('.osmap-loading').remove();},1000);};$.fn.osmap={loadSitemapItems:function(params){var url=params.baseUri.replace(/\/$/,'');url+='/index.php?option=com_osmap&view=adminsitemapitems&tmpl=component&id='+params.sitemapId;if(params.language!==''){url+='&lang='+params.language;}
$.ajax({url:url,async:true,success:function(data){$(params.container).html(data);configureForm(params.lang);$('.hasTooltip').tooltip();}});}};})(jQuery);